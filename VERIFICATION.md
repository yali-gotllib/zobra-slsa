# SLSA Provenance Verification

Complete guide for verifying SLSA Level 3 provenance generated by the workflows.

## üéØ Overview

After generating SLSA provenance, you can verify the authenticity and integrity of your artifacts using official verification tools. This proves that artifacts were built from expected source code in a trusted environment.

## üõ†Ô∏è Prerequisites

### **Install slsa-verifier**
```bash
# Install the official SLSA verification tool
go install github.com/slsa-framework/slsa-verifier/v2/cli/slsa-verifier@latest
```

### **Install GitHub CLI (for GitHub-hosted artifacts)**
```bash
# macOS
brew install gh

# Linux
curl -fsSL https://cli.github.com/packages/githubcli-archive-keyring.gpg | sudo dd of=/usr/share/keyrings/githubcli-archive-keyring.gpg
echo "deb [arch=$(dpkg --print-architecture) signed-by=/usr/share/keyrings/githubcli-archive-keyring.gpg] https://cli.github.com/packages stable main" | sudo tee /etc/apt/sources.list.d/github-cli.list > /dev/null
sudo apt update
sudo apt install gh

# Windows
winget install --id GitHub.cli
```

## üì¶ Verifying Artifacts

### **Universal Artifact Workflow Verification**

#### **1. Find the Correct Digest**
```bash
# For container images, get the digest from the workflow diagnostic job
# Look for: "üîç Checking attestation for: IMAGE@sha256:..."
# This shows the exact digest that has the SLSA attestation

# Alternative: Check the workflow "Extract digest" step in build job
```

#### **2. Verify with slsa-verifier**
```bash
# Verify artifact with SLSA provenance
slsa-verifier verify-artifact your-artifact.tar.gz \
  --provenance-path your-artifact.tar.gz.intoto.jsonl \
  --source-uri github.com/your-org/your-repo \
  --source-tag v1.0.0
```

#### **3. Expected Output**
```
‚úì Verified signature against tlog entry index 12345678
‚úì Verified build using builder "https://github.com/slsa-framework/slsa-github-generator/.github/workflows/generator_generic_slsa3.yml@refs/tags/v2.1.0"
‚úì Verified artifact built from "github.com/your-org/your-repo@refs/tags/v1.0.0"

PASSED: SLSA verification passed
```

### **Language-Specific Examples**

#### **Go Binary**
```bash
slsa-verifier verify-artifact myapp \
  --provenance-path myapp.intoto.jsonl \
  --source-uri github.com/your-org/go-app \
  --source-tag v1.0.0
```

#### **Python Package**
```bash
slsa-verifier verify-artifact mypackage-1.0.0-py3-none-any.whl \
  --provenance-path mypackage-1.0.0-py3-none-any.whl.intoto.jsonl \
  --source-uri github.com/your-org/python-package \
  --source-tag v1.0.0
```

#### **Node.js Package**
```bash
slsa-verifier verify-artifact mypackage-1.0.0.tgz \
  --provenance-path mypackage-1.0.0.tgz.intoto.jsonl \
  --source-uri github.com/your-org/node-package \
  --source-tag v1.0.0
```

## üê≥ Verifying Container Images

### **Professional Container Workflow Verification**

#### **1. Verify with slsa-verifier**
```bash
# Verify container image with SLSA provenance
slsa-verifier verify-image docker.io/username/myapp:v1.0.0 \
  --source-uri github.com/your-org/your-repo \
  --source-tag v1.0.0
```

#### **2. Registry-Specific Examples**

**Docker Hub:** ‚úÖ **VERIFIED WORKING**
```bash
# Use the digest from the workflow diagnostic job
slsa-verifier verify-image docker.io/username/myapp@sha256:abc123... \
  --source-uri github.com/username/myapp \
  --source-branch main

# Example with actual working digest:
slsa-verifier verify-image docker.io/yaliwizgottlib/example-image-project@sha256:cc88c9d7ba8d7e6e9c02aa9e790ce771ff3ff5af4131772074c272ce9278ea47 \
  --source-uri github.com/yali-gotllib/example-image-project \
  --source-branch main
```

**GitHub Container Registry:**
```bash
slsa-verifier verify-image ghcr.io/username/myapp:v1.0.0 \
  --source-uri github.com/username/myapp \
  --source-tag v1.0.0
```

**Google Container Registry:**
```bash
slsa-verifier verify-image gcr.io/project-id/myapp:v1.0.0 \
  --source-uri github.com/username/myapp \
  --source-tag v1.0.0
```

#### **3. Expected Output**
```
‚úì Verified signature against tlog entry index 87654321
‚úì Verified build using builder "https://github.com/slsa-framework/slsa-github-generator/.github/workflows/generator_container_slsa3.yml@refs/tags/v2.1.0"
‚úì Verified container image built from "github.com/your-org/your-repo@refs/tags/v1.0.0"

PASSED: SLSA verification passed
```

### **Alternative: Cosign Verification**
```bash
# Install cosign
go install github.com/sigstore/cosign/v2/cmd/cosign@latest

# Verify container signature and attestation
cosign verify-attestation docker.io/username/myapp:v1.0.0 \
  --type slsaprovenance \
  --certificate-identity-regexp ".*" \
  --certificate-oidc-issuer-regexp ".*"
```

## üîç Inspecting Provenance

### **View Provenance Details**
```bash
# Download and inspect provenance
slsa-verifier verify-artifact your-artifact.tar.gz \
  --provenance-path your-artifact.tar.gz.intoto.jsonl \
  --source-uri github.com/your-org/your-repo \
  --source-tag v1.0.0 \
  --print-provenance
```

### **Key Provenance Fields**
```json
{
  "buildDefinition": {
    "buildType": "https://github.com/slsa-framework/slsa-github-generator/generic@v1",
    "externalParameters": {
      "source": {
        "uri": "git+https://github.com/your-org/your-repo@refs/tags/v1.0.0",
        "digest": {"sha1": "abc123..."}
      }
    }
  },
  "runDetails": {
    "builder": {
      "id": "https://github.com/slsa-framework/slsa-github-generator/.github/workflows/generator_generic_slsa3.yml@refs/tags/v2.1.0"
    },
    "metadata": {
      "invocationId": "https://github.com/your-org/your-repo/actions/runs/123456789"
    }
  }
}
```

## ‚úÖ Verification Best Practices

### **1. Always Verify Source URI**
```bash
# Ensure the source URI matches your expected repository
--source-uri github.com/your-org/your-repo
```

### **2. Verify Specific Tags/Commits**
```bash
# Use specific tags for releases
--source-tag v1.0.0

# Or verify specific commits
--source-sha abc123def456...
```

### **3. Check Builder Identity**
```bash
# Ensure artifacts were built by trusted SLSA generator
# Look for: "slsa-framework/slsa-github-generator" in verification output
```

### **4. Validate Build Environment**
```bash
# Verify builds ran in GitHub-hosted runners
# Check provenance for runner details
```

## üö® Troubleshooting Verification

### **Common Issues**

#### **"No matching attestations" for Container Images**
```bash
# 1. Ensure you're using the correct digest
# Check the workflow "fix-docker-attestation" or "fix-gcr-attestation" job logs
# Look for: "üîç Checking attestation for: IMAGE@sha256:..."

# 2. Use the exact digest from the diagnostic job
./slsa-verifier verify-image docker.io/username/myapp@sha256:CORRECT_DIGEST \
  --source-uri github.com/username/repo \
  --source-branch main

# 3. If still failing, check if attestation was actually uploaded
cosign verify-attestation docker.io/username/myapp@sha256:DIGEST \
  --type slsaprovenance \
  --certificate-identity-regexp ".*" \
  --certificate-oidc-issuer-regexp ".*"
```

#### **"No provenance found" for Artifacts**
```bash
# Check if provenance file exists
ls -la *.intoto.jsonl

# Verify provenance was uploaded with artifact
gh release view v1.0.0 --repo your-org/your-repo
```

#### **"Source URI mismatch"**
```bash
# Ensure source URI exactly matches repository
# Use full GitHub URL: github.com/owner/repo
```

#### **"Tag not found"**
```bash
# Verify tag exists and matches
git tag -l
git show v1.0.0
```

#### **"Certificate verification failed"**
```bash
# Check if using correct verification tool version
slsa-verifier version

# Update to latest version
go install github.com/slsa-framework/slsa-verifier/v2/cli/slsa-verifier@latest
```

### **Debug Steps**
1. **Check provenance exists** - Verify `.intoto.jsonl` files are present
2. **Validate source information** - Ensure repository and tag are correct
3. **Test with verbose output** - Add `--verbose` flag for detailed logs
4. **Verify network access** - Ensure access to transparency logs

## üîê Security Considerations

### **What Verification Proves**
‚úÖ **Artifact authenticity** - Built from specified source code  
‚úÖ **Build integrity** - No tampering during build process  
‚úÖ **Source verification** - Links to exact source repository and commit  
‚úÖ **Builder trust** - Built using trusted SLSA generator  
‚úÖ **Transparency** - Recorded in public transparency logs  

### **What Verification Doesn't Prove**
‚ùå **Source code quality** - Verification doesn't audit code for vulnerabilities  
‚ùå **Runtime behavior** - Only verifies build process, not execution  
‚ùå **Dependency security** - Doesn't verify security of dependencies  

### **Additional Security Measures**
- **Code review** - Review source code before building
- **Dependency scanning** - Scan dependencies for vulnerabilities
- **Runtime monitoring** - Monitor application behavior in production
- **Regular updates** - Keep dependencies and tools updated

---

**For workflow configuration, see [WORKFLOWS.md](WORKFLOWS.md)**
