# SLSA Implementation Requirements

This document outlines the requirements for generating and verifying SLSA Level 3 provenance for any programming language.

## Overview

SLSA (Supply-chain Levels for Software Artifacts) provides cryptographic proof of how software was built. This implementation uses the generic SLSA generator which works for all programming languages and provides the same security guarantees as language-specific builders.

## Generation Requirements

### Workflow Structure

Create a GitHub Actions workflow with two jobs:

1. **Build Job**: Compiles artifacts and generates hashes
2. **Provenance Job**: Calls the SLSA generic generator

### Required Components

#### SLSA Generator
```yaml
uses: slsa-framework/slsa-github-generator/.github/workflows/generator_generic_slsa3.yml@v2.1.0
```

#### Build Job Template
```yaml
build:
  runs-on: ubuntu-latest
  outputs:
    hashes: ${{ steps.hash.outputs.hashes }}
  steps:
    - uses: actions/checkout@v4
    - name: Setup Environment
      # Language-specific setup (Python, Go, Node.js, etc.)
    - name: Build Artifacts
      # Language-specific build commands
    - name: Generate Hashes
      id: hash
      run: |
        echo "hashes=$(sha256sum * | base64 -w0)" >> "$GITHUB_OUTPUT"
    - name: Upload Artifacts
      uses: actions/upload-artifact@v4
      with:
        name: build-artifacts
        path: ./*
```

#### Provenance Job Template
```yaml
provenance:
  needs: [build]
  permissions:
    actions: read
    id-token: write
    contents: write
  uses: slsa-framework/slsa-github-generator/.github/workflows/generator_generic_slsa3.yml@v2.1.0
  with:
    base64-subjects: "${{ needs.build.outputs.hashes }}"
    upload-assets: true
    upload-tag-name: ${{ github.ref_name }}
    provenance-name: "slsa-provenance.intoto.jsonl"
```

### Language-Specific Build Examples

#### Python
```yaml
- name: Set up Python
  uses: actions/setup-python@v4
  with:
    python-version: '3.9'
- name: Build Package
  run: |
    pip install build
    python -m build
```

#### Go
```yaml
- name: Set up Go
  uses: actions/setup-go@v4
  with:
    go-version: '1.21'
- name: Build Binary
  run: go build -o myapp main.go
```

#### Node.js
```yaml
- name: Set up Node.js
  uses: actions/setup-node@v4
  with:
    node-version: '18'
- name: Build Package
  run: |
    npm install
    npm run build
    npm pack
```

### Critical Requirements

#### Version Constraints
- SLSA Generator: v2.1.0 or later
- GitHub Actions: Use v4 versions (v3 deprecated)
- Checkout: actions/checkout@v4
- Upload Artifact: actions/upload-artifact@v4

#### Permissions
The provenance job requires specific permissions:
```yaml
permissions:
  actions: read      # Read workflow path
  id-token: write    # Sign provenance
  contents: write    # Upload to releases
```

#### Hash Generation
Must use this exact format:
```bash
sha256sum * | base64 -w0
```

## Verification Requirements

### Prerequisites

#### Install slsa-verifier
```bash
go install github.com/slsa-framework/slsa-verifier/v2/cli/slsa-verifier@latest
```

#### Required Files
- Built artifact (binary, package, etc.)
- SLSA provenance file (.intoto.jsonl)
- Source repository information

### Verification Command

```bash
slsa-verifier verify-artifact [artifact-file] \
  --provenance-path [provenance-file.intoto.jsonl] \
  --source-uri github.com/[owner]/[repository] \
  --source-branch [branch-name]
```

### Success Indicators

A successful verification shows:
```
Verified build using builder "https://github.com/slsa-framework/slsa-github-generator/.github/workflows/generator_generic_slsa3.yml@refs/tags/v2.1.0"
Verifying artifact [artifact-file]: PASSED
PASSED: SLSA verification passed
```

### Verification Parameters

#### Source URI
- Format: `github.com/owner/repository`
- Must match the repository where artifacts were built

#### Source Reference
- Use `--source-branch main` for main branch builds
- Use `--source-tag v1.0.0` for tagged releases
- Must match the actual source used in build

## SLSA Level 3 Compliance

This implementation provides SLSA Level 3 by ensuring:

### Non-forgeable Provenance
- Signing keys managed by SLSA framework
- User builds cannot access or modify signing process
- All provenance fields generated by trusted builder

### Ephemeral and Isolated Environment
- GitHub Actions provides fresh VMs per build
- No cross-build contamination
- No persistent state between builds

### Cryptographic Verification
- Digital signatures via Sigstore
- Transparency log recording
- Tamper-evident provenance

## Troubleshooting

### Common Issues

#### "Untrusted reusable workflow"
- Cause: Using SLSA generator version < v2.1.0
- Solution: Update to v2.1.0 or later

#### "Invalid ref" errors
- Cause: Mismatch between provenance source and verification parameters
- Solution: Ensure --source-branch or --source-tag matches build source

#### Build failures
- Cause: Using deprecated GitHub Actions (v3)
- Solution: Update all actions to v4 versions

### Builder ID Verification

The provenance must show the SLSA generator as builder:
```
https://github.com/slsa-framework/slsa-github-generator/.github/workflows/generator_generic_slsa3.yml@refs/tags/v2.1.0
```

If it shows your workflow instead, update the SLSA generator version.

## Benefits

### Universal Approach
- Same workflow pattern for all languages
- Consistent security guarantees
- Single verification tool

### Production Ready
- Enterprise-grade supply chain security
- Global verification capability
- Cryptographic proof of build integrity

### Maintenance
- Generic generator is actively maintained
- No language-specific builder dependencies
- Reliable and stable implementation
